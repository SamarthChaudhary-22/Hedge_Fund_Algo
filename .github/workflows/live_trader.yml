name: 24/7 Continuous Trader

on:
  schedule:
    # Restart both bots every 6 hours (00:00, 06:00, 12:00, 18:00)
    - cron: '0 */6 * * *'
  workflow_dispatch: # Manual run button

concurrency:
  group: live-trader
  cancel-in-progress: true

jobs:
  # --- JOB 1: THE LONG BOT (Bull) ---
  long_strategy:
    name: üêÇ Long Bot
    runs-on: ubuntu-latest
    timeout-minutes: 360 # 6 Hours
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install Dependencies
        run: pip install -r requirements.txt

      - name: Run Hedge Fund Bot
        env:
          APCA_API_KEY_ID: ${{ secrets.APCA_API_KEY_ID }}
          APCA_API_SECRET_KEY: ${{ secrets.APCA_API_SECRET_KEY }}
          PYTHONUNBUFFERED: '1'
        run: python Hedge_Fund_Bot.py

  # --- JOB 2: THE SHORT BOT (Bear) ---
  short_strategy:
    name: üêª Short Bot
    runs-on: ubuntu-latest
    timeout-minutes: 360 # 6 Hours
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install Dependencies
        # Note: Ensure 'yfinance' is in your requirements.txt!
        run: pip install -r requirements.txt

      - name: Run Grizzly Short Engine
        env:
          APCA_API_KEY_ID: ${{ secrets.APCA_API_KEY_ID }}
          APCA_API_SECRET_KEY: ${{ secrets.APCA_API_SECRET_KEY }}
          PYTHONUNBUFFERED: '1'
        # CHECK: Is your file named Short_Engine.py or Short_Selling_Engine.py?
        # I updated it to Short_Selling_Engine.py based on our chat history.
        run: python Short_Selling_Engine.py

  # --- JOB 3: THE DISCORD LISTENER (Notifications) ---
  discord_listener:
    name: üéß Discord Listener
    runs-on: ubuntu-latest
    timeout-minutes: 360 # 6 Hours
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install Dependencies
        # Note: Ensure 'requests' is in your requirements.txt!
        run: pip install -r requirements.txt

      - name: Run Discord Listener
        env:
          APCA_API_KEY_ID: ${{ secrets.APCA_API_KEY_ID }}
          APCA_API_SECRET_KEY: ${{ secrets.APCA_API_SECRET_KEY }}
          # Remember to add DISCORD_WEBHOOK_URL to your GitHub Secrets!
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
          PYTHONUNBUFFERED: '1'
        run: python Discord_Listener.py
